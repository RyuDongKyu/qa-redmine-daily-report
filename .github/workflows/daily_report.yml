name: QA Redmine Daily Report

on:
  schedule:
    # 한국 시간(KST) 오전 08:00 실행
    # 계산: 08:00 - 9시간 = (전날) 23:00
    - cron: '0 23 * * 0-4'
  workflow_dispatch:

jobs:
  run-report:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11' # 3.9에서 3.11로 업그레이드하여 경고 해결

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # [중요] 최신 SDK 설치 (404 에러 해결의 핵심)
        pip install google-genai gspread oauth2client pandas

    - name: Create Service Key File
      run: echo '${{ secrets.GOOGLE_SERVICE_KEY }}' > service_key.json

    - name: Run Report Script
      env:
        #GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        KIMI_API_KEY: ${{ secrets.KIMI_API_KEY }}
        SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}
        SENDER_PASSWORD: ${{ secrets.SENDER_PASSWORD }}
        RECIPIENT_EMAIL: ${{ secrets.RECIPIENT_EMAIL }}
        SHEET_ID: ${{ secrets.SHEET_ID }}
      run: python ai_qa_redmine_daily_report.py
